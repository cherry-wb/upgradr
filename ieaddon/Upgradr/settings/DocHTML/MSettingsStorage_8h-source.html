<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SettingsStorage: MSettingsStorage.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a></div>
<h1>MSettingsStorage.h</h1><div class="fragment"><pre>00001 <span class="comment">//========================================================================================</span>
00002 <span class="comment">//</span>
00003 <span class="comment">// Module:          SettingsStorage</span>
00004 <span class="comment">// Author:          Pascal Hurni</span>
00005 <span class="comment">// Creation Date:   20.12.2003</span>
00006 <span class="comment">//</span>
00007 <span class="comment">// Copyright 2003 Mortimer Systems</span>
00008 <span class="comment">// This software is free. I grant you a non-exclusive license to use it.</span>
00009 <span class="comment">//</span>
00010 <span class="comment">// This work is based on CRegSettings, Copyright (C) 2002 Magomed G. Abdurakhmanov, maq@mail.ru</span>
00011 <span class="comment">//</span>
00012 <span class="comment">// Modifications:</span>
00013 <span class="comment">//</span>
00014 <span class="comment">//  2004-05-11  By Pascal Hurni</span>
00015 <span class="comment">//</span>
00016 <span class="comment">//              Load() and Save() updated. The storage OnAfterXXX() was not called if OnBeforeXXX()</span>
00017 <span class="comment">//              returned false. It now is like the documentation tells.</span>
00018 <span class="comment">//</span>
00019 <span class="comment">//              Added GenerateAloneItemName() virtual functions, so that subclasses can override the</span>
00020 <span class="comment">//              way items are named. Usefull for the XML subclass.</span>
00021 <span class="comment">//</span>
00022 <span class="comment">//              Collections: if OnItemCollection() returned no more item (&lt;0), the item was still</span>
00023 <span class="comment">//              added to the collection. Fixed, so that empty non-count based collection are possible.</span>
00024 <span class="comment">//</span>
00025 <span class="comment">//  2004-05-11  By Pascal Hurni</span>
00026 <span class="comment">//</span>
00027 <span class="comment">//              Added mandatory function for CSettingsStorage subclasses: CreateSubStorage()</span>
00028 <span class="comment">//              This enables the followings:</span>
00029 <span class="comment">//                1. Implemented Collection related functions in the base class CSettingsStorage.</span>
00030 <span class="comment">//                2. Implemented SaveLoadItem() for subitem in the base class CSettingsStorage.</span>
00031 <span class="comment">//              This saves subclasses from implmenting them. For special cases, subclasses</span>
00032 <span class="comment">//              can still override the standard behaviour.</span>
00033 <span class="comment">//</span>
00034 <span class="comment">//              SaveLoadItemSTL() and SaveLoadItemCArray(): When an item failed, the rest</span>
00035 <span class="comment">//              of the collection was skipped. Skipping is now determined by Storage::ContinueOnError().</span>
00036 <span class="comment">//</span>
00037 <span class="comment">//              SaveLoadItem() with std:string and std::wstring missed conversion from/to UNICODE when</span>
00038 <span class="comment">//              saving. Loading was fine.</span>
00039 <span class="comment">//</span>
00040 <span class="comment">//  2004-04-19  By Pascal Hurni</span>
00041 <span class="comment">//</span>
00042 <span class="comment">//              SaveLoadItem() for CString and std::(w)string updated to follow spec</span>
00043 <span class="comment">//              of TCHAR SaveLoadItem().</span>
00044 <span class="comment">//</span>
00045 <span class="comment">//  2004-04-16  By Pascal Hurni</span>
00046 <span class="comment">//</span>
00047 <span class="comment">//              FIXED BUG: The SETTING_ITEM_BINARY macro used SaveLoadItemSTL() instead of</span>
00048 <span class="comment">//              SaveLoadItem().</span>
00049 <span class="comment">//</span>
00050 <span class="comment">//========================================================================================</span>
00051 
00052 <span class="preprocessor">#ifndef __MORTIMER_SETTINGSSTORAGE_H__</span>
00053 <span class="preprocessor"></span><span class="preprocessor">#define __MORTIMER_SETTINGSSTORAGE_H__</span>
00054 <span class="preprocessor"></span>
00055 <span class="comment">//========================================================================================</span>
00056 <span class="comment">// encapsulate these classes in a namespace</span>
00057 
00058 <span class="preprocessor">#ifndef DOXYGEN_SHOULD_SKIP_THIS</span>
00059 <span class="preprocessor"></span><span class="keyword">namespace </span>Mortimer
00060 {
00061 <span class="preprocessor">#endif</span>
00062 <span class="preprocessor"></span>
00063 <span class="comment">//========================================================================================</span>
00064 
00065 <span class="keyword">class </span><a class="code" href="classCSettingsStorage.html">CSettingsStorage</a>;
00066 
<a name="l00075"></a><a class="code" href="classCSettings.html">00075</a> <span class="keyword">class </span><a class="code" href="classCSettings.html">CSettings</a>
00076 {
00077 <span class="keyword">protected</span>:
00083 
00084 
00085     <span class="keyword">virtual</span> <span class="keywordtype">void</span> OnBeforeSave(<span class="keywordtype">bool</span> StorageOk) {}
00086     <span class="keyword">virtual</span> <span class="keywordtype">void</span> OnAfterSave(<span class="keywordtype">bool</span> StorageOk) {}
00087     <span class="keyword">virtual</span> <span class="keywordtype">void</span> OnBeforeLoad(<span class="keywordtype">bool</span> StorageOk) {}
00088     <span class="keyword">virtual</span> <span class="keywordtype">void</span> OnAfterLoad(<span class="keywordtype">bool</span> StorageOk) {}
00089 
00091 
00092     <span class="comment">// The map will override this one</span>
00093     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> InternalSaveLoad(<span class="keywordtype">bool</span> Continue, <a class="code" href="classCSettingsStorage.html">CSettingsStorage</a> *pStorage, <span class="keywordtype">bool</span> bSave, <span class="keywordtype">bool</span> bOnlyInit) = 0;
00094 
00095 <span class="keyword">public</span>:
00100     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> Load(<a class="code" href="classCSettingsStorage.html">CSettingsStorage</a> &amp;Storage);
00101 
00106     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> Save(<a class="code" href="classCSettingsStorage.html">CSettingsStorage</a> &amp;Storage);
00107 
00108 }; <span class="comment">// class CSettings</span>
00109 
00110 <span class="comment">// Forward declaration</span>
00111 <span class="comment">//class CSettings;</span>
00112 
<a name="l00118"></a><a class="code" href="classCSettingsStorage.html">00118</a> <span class="keyword">class </span><a class="code" href="classCSettingsStorage.html">CSettingsStorage</a>
00119 {
00120 <span class="keyword">public</span>:
00122 
00123 
00124 
00125 
00126 
00127     <span class="keyword">virtual</span> <a class="code" href="classCSettingsStorage.html">CSettingsStorage</a> *CreateSubStorage(LPCTSTR SubName) = 0;
00128 
00131     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> ContinueOnError() = 0;
00132 
00134     <span class="comment">//------------------------------------------------------------------------------------</span>
00138 <span class="comment"></span>
00139     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> OnBeforeSave() { <span class="keywordflow">return</span> <span class="keyword">true</span>; }
00140     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> OnAfterSave() { <span class="keywordflow">return</span> <span class="keyword">true</span>; }
00141     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> OnBeforeLoad() { <span class="keywordflow">return</span> <span class="keyword">true</span>; }
00142     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> OnAfterLoad() { <span class="keywordflow">return</span> <span class="keyword">true</span>; }
00143 
00144 <span class="keyword">public</span>:
00145     <span class="comment">//------------------------------------------------------------------------------------</span>
00146     <span class="comment">// Type specific SaveLoad functions.</span>
00147 
00150 
00151     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, <span class="keywordtype">long</span>&amp; Variable, <span class="keywordtype">bool</span> bSave) = 0;
00152     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>&amp; Variable, <span class="keywordtype">bool</span> bSave) = 0;
00154 
00157 
00158     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, <span class="keywordtype">bool</span>&amp; Variable, <span class="keywordtype">bool</span> bSave) = 0;
00159     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, <span class="keywordtype">double</span>&amp; Variable, <span class="keywordtype">bool</span> bSave) = 0;
00161 
00164 
00165 
00172     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, TCHAR* Variable, ULONG&amp; size, <span class="keywordtype">bool</span> bSave) = 0;
00173 
00175     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, <span class="keywordtype">void</span>* Variable, ULONG size, <span class="keywordtype">bool</span> bSave) = 0;
00176 
00178     <span class="comment">//------------------------------------------------------------------------------------</span>
00183 <span class="comment"></span>
00184 
00185 <span class="keyword">protected</span>:
<a name="l00192"></a><a class="code" href="classCSettingsStorage.html#z12_0">00192</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> OnBeginCollection(LPCTSTR szName, UINT&amp; ItemCount, <span class="keywordtype">bool</span> bSave)
00193     {
00194         m_pCollectionStorage = CreateSubStorage(szName);
00195         <span class="keywordflow">if</span> (!m_pCollectionStorage || (ItemCount == 0xFFFFFFFF))
00196             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00197 
00198         <span class="keywordflow">if</span> (bSave)
00199             m_pCollectionStorage-&gt;OnBeforeSave();
00200         <span class="keywordflow">else</span>
00201             m_pCollectionStorage-&gt;OnBeforeLoad();
00202 
00203         <span class="comment">// Save or Load the item count. Without Count items are useless, so fail.</span>
00204         <span class="keywordflow">if</span> (!m_pCollectionStorage-&gt;SaveLoadItem(_T(<span class="stringliteral">"Count"</span>), ItemCount, bSave))
00205             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00206 
00207         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00208     }
00209 
<a name="l00215"></a><a class="code" href="classCSettingsStorage.html#z12_1">00215</a>     <span class="keyword">virtual</span> <span class="keywordtype">int</span> OnItemCollection(UINT Index, <a class="code" href="classCSettings.html">CSettings</a> &amp;variable, <span class="keywordtype">bool</span> bSave)
00216     {
00217         <span class="keywordflow">if</span> (!m_pCollectionStorage)
00218             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00219 
00220         TCHAR ItemName[16];
00221         _stprintf(ItemName, _T(<span class="stringliteral">"%i"</span>), Index);
00222         <a class="code" href="classCSettingsStorage.html">CSettingsStorage</a> *pSubStorage = m_pCollectionStorage-&gt;CreateSubStorage(ItemName);
00223         <span class="keywordflow">if</span> (!pSubStorage)
00224             <span class="keywordflow">return</span> 0;
00225 
00226         <span class="keywordtype">int</span> Result;
00227         <span class="keywordflow">if</span> (bSave)
00228             Result = variable.<a class="code" href="classCSettings.html#a1">Save</a>(*pSubStorage) ? 1 : 0;
00229         <span class="keywordflow">else</span>
00230             Result = variable.<a class="code" href="classCSettings.html#a0">Load</a>(*pSubStorage) ? 1 : 0;
00231 
00232         <span class="keyword">delete</span> pSubStorage;
00233         <span class="keywordflow">return</span> Result;
00234     }
00235 
<a name="l00237"></a><a class="code" href="classCSettingsStorage.html#z12_2">00237</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> OnEndCollection(<span class="keywordtype">bool</span> bSave)
00238     {
00239         <span class="keywordflow">if</span> (!m_pCollectionStorage)
00240             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00241 
00242         <span class="keywordflow">if</span> (bSave)
00243             m_pCollectionStorage-&gt;<a class="code" href="classCSettingsStorage.html#z4_1">OnAfterSave</a>();
00244         <span class="keywordflow">else</span>
00245             m_pCollectionStorage-&gt;OnAfterLoad();
00246 
00247         <span class="keyword">delete</span> m_pCollectionStorage;
00248         m_pCollectionStorage = NULL;
00249 
00250         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00251     }
00252 
<a name="l00254"></a><a class="code" href="classCSettingsStorage.html#z12_3">00254</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> OnBeginAloneCollection(LPCTSTR szName, UINT&amp; ItemCount, <span class="keywordtype">bool</span> bSave)
00255     {
00256         m_pCollectionStorage = CreateSubStorage(szName);
00257         <span class="keywordflow">if</span> (!m_pCollectionStorage)
00258             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00259 
00260         <span class="keywordtype">bool</span> bResult;
00261         <span class="keywordflow">if</span> (bSave)
00262             bResult = m_pCollectionStorage-&gt;OnBeforeSave();
00263         <span class="keywordflow">else</span>
00264             bResult = m_pCollectionStorage-&gt;OnBeforeLoad();
00265 
00266         <span class="comment">// Save or Load the item count. Without Count items are useless, so fail.</span>
00267         <span class="keywordflow">if</span> (!m_pCollectionStorage-&gt;SaveLoadItem(_T(<span class="stringliteral">"Count"</span>), ItemCount, bSave))
00268         {
00269             <span class="keywordflow">if</span> (bSave)
00270                 m_pCollectionStorage-&gt;OnAfterSave();
00271             <span class="keywordflow">else</span>
00272                 m_pCollectionStorage-&gt;OnAfterLoad();
00273             <span class="keyword">delete</span> m_pCollectionStorage;
00274             m_pCollectionStorage = NULL;
00275             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00276         }
00277 
00278         <span class="keywordflow">return</span> bResult;
00279     }
00280 
<a name="l00289"></a><a class="code" href="classCSettingsStorage.html#z12_4">00289</a>     <span class="keyword">virtual</span> <span class="keywordtype">int</span> OnItemAloneCollection(UINT Index, <span class="keywordtype">bool</span> bSave, LPCTSTR &amp;ItemName)
00290     {
00291         _stprintf(m_ItemName, <span class="stringliteral">"Item.%i"</span>, Index);
00292         ItemName = m_ItemName;
00293         <span class="keywordflow">return</span> 1;
00294     }
00295 
<a name="l00297"></a><a class="code" href="classCSettingsStorage.html#z12_5">00297</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> OnEndAloneCollection(<span class="keywordtype">bool</span> bSave)
00298     {
00299         <span class="keywordflow">if</span> (!m_pCollectionStorage)
00300             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00301 
00302         <span class="keywordtype">bool</span> bResult;
00303         <span class="keywordflow">if</span> (bSave)
00304             bResult = m_pCollectionStorage-&gt;OnAfterSave();
00305         <span class="keywordflow">else</span>
00306             bResult = m_pCollectionStorage-&gt;OnAfterLoad();
00307 
00308         <span class="keyword">delete</span> m_pCollectionStorage;
00309         m_pCollectionStorage = NULL;
00310 
00311         <span class="keywordflow">return</span> bResult;
00312     }
00313 
00315     <span class="comment">//------------------------------------------------------------------------------------</span>
00321 <span class="comment"></span>
00322 
00323 <span class="keyword">public</span>:
00324     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, <span class="keywordtype">int</span>&amp; Variable, <span class="keywordtype">bool</span> bSave)
00325     {
00326         <span class="keywordtype">long</span> Value = (<span class="keywordtype">long</span>)Variable;
00327         <span class="keywordtype">bool</span> bResult = SaveLoadItem(szName, Value, bSave);
00328         <span class="keywordflow">if</span> (!bSave &amp;&amp; bResult)
00329             Variable = (<span class="keywordtype">int</span>)Value;
00330         <span class="keywordflow">return</span> bResult;
00331     }
00332 
00333     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; Variable, <span class="keywordtype">bool</span> bSave)
00334     {
00335         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> Value = (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)Variable;
00336         <span class="keywordtype">bool</span> bResult = SaveLoadItem(szName, Value, bSave);
00337         <span class="keywordflow">if</span> (!bSave &amp;&amp; bResult)
00338             Variable = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)Value;
00339         <span class="keywordflow">return</span> bResult;
00340     }
00341 
00342     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, <span class="keywordtype">short</span>&amp; Variable, <span class="keywordtype">bool</span> bSave)
00343     {
00344         <span class="keywordtype">long</span> Value = (<span class="keywordtype">long</span>)Variable;
00345         <span class="keywordtype">bool</span> bResult = SaveLoadItem(szName, Value, bSave);
00346         <span class="keywordflow">if</span> (!bSave &amp;&amp; bResult)
00347             Variable = (<span class="keywordtype">short</span>)Value;
00348         <span class="keywordflow">return</span> bResult;
00349     }
00350 
00351     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>&amp; Variable, <span class="keywordtype">bool</span> bSave)
00352     {
00353         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> Value = (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)Variable;
00354         <span class="keywordtype">bool</span> bResult = SaveLoadItem(szName, Value, bSave);
00355         <span class="keywordflow">if</span> (!bSave &amp;&amp; bResult)
00356             Variable = (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)Value;
00357         <span class="keywordflow">return</span> bResult;
00358     }
00359 
00360     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, <span class="keywordtype">signed</span> <span class="keywordtype">char</span>&amp; Variable, <span class="keywordtype">bool</span> bSave)
00361     {
00362         <span class="keywordtype">long</span> Value = (<span class="keywordtype">long</span>)Variable;
00363         <span class="keywordtype">bool</span> bResult = SaveLoadItem(szName, Value, bSave);
00364         <span class="keywordflow">if</span> (!bSave &amp;&amp; bResult)
00365             Variable = (<span class="keywordtype">signed</span> <span class="keywordtype">char</span>)Value;
00366         <span class="keywordflow">return</span> bResult;
00367     }
00368 
00369     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>&amp; Variable, <span class="keywordtype">bool</span> bSave)
00370     {
00371         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> Value = (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)Variable;
00372         <span class="keywordtype">bool</span> bResult = SaveLoadItem(szName, Value, bSave);
00373         <span class="keywordflow">if</span> (!bSave &amp;&amp; bResult)
00374             Variable = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)Value;
00375         <span class="keywordflow">return</span> bResult;
00376     }
00377 
00378     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, LONGLONG&amp; Variable, <span class="keywordtype">bool</span> bSave)
00379     {
00380         <span class="keywordflow">return</span> SaveLoadItem(szName, &amp;Variable, <span class="keyword">sizeof</span>(Variable), bSave);
00381     }
00382 
00383     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, ULONGLONG&amp; Variable, <span class="keywordtype">bool</span> bSave)
00384     {
00385         <span class="keywordflow">return</span> SaveLoadItem(szName, &amp;Variable, <span class="keyword">sizeof</span>(Variable), bSave);
00386     }
00387 
00388     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, <span class="keywordtype">float</span>&amp; Variable, <span class="keywordtype">bool</span> bSave)
00389     {
00390         <span class="keywordtype">double</span> Value = (<span class="keywordtype">double</span>)Variable;
00391         <span class="keywordtype">bool</span> bResult = SaveLoadItem(szName, Value, bSave);
00392         <span class="keywordflow">if</span> (!bSave &amp;&amp; bResult)
00393             Variable = (<span class="keywordtype">float</span>)Value;
00394         <span class="keywordflow">return</span> bResult;
00395     }
00396 
<a name="l00399"></a><a class="code" href="classCSettingsStorage.html#z14_9">00399</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, <a class="code" href="classCSettings.html">CSettings</a>&amp; Variable, <span class="keywordtype">bool</span> bSave)
00400     {
00401         <a class="code" href="classCSettingsStorage.html">CSettingsStorage</a> *pSubStorage = CreateSubStorage(szName);
00402         <span class="keywordflow">if</span> (!pSubStorage)
00403             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00404 
00405         <span class="keywordtype">bool</span> Result;
00406         <span class="keywordflow">if</span> (bSave)
00407             Result = Variable.<a class="code" href="classCSettings.html#a1">Save</a>(*pSubStorage);
00408         <span class="keywordflow">else</span>
00409             Result = Variable.<a class="code" href="classCSettings.html#a0">Load</a>(*pSubStorage);
00410 
00411         <span class="keyword">delete</span> pSubStorage;
00412         <span class="keywordflow">return</span> Result;
00413     }
00414 
00415 <span class="preprocessor">#if defined(_MFC_VER) || defined(_WTL_USE_CSTRING)</span>
00416 <span class="preprocessor"></span>    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, CString&amp; Variable, <span class="keywordtype">bool</span> bSave)
00417     {
00418         <span class="keywordflow">if</span>(bSave)
00419         {
00420             ULONG Size = Variable.GetLength();
00421             <span class="keywordflow">return</span> SaveLoadItem(szName, (TCHAR*)(LPCTSTR)Variable, Size, bSave);
00422         }
00423         <span class="keywordflow">else</span>
00424         {
00425             DWORD dwSize = 128;
00426             <span class="keywordtype">bool</span> bResult = SaveLoadItem(szName, Variable.GetBuffer(dwSize), dwSize, bSave);
00427             <span class="keywordflow">if</span> (!bResult)
00428             {
00429                 <span class="keywordflow">if</span> (dwSize == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00430                 bResult = SaveLoadItem(szName, Variable.GetBuffer(dwSize), dwSize, bSave);
00431             }
00432             Variable.ReleaseBuffer();
00433             <span class="keywordflow">return</span> bResult;
00434         }
00435     }
00436 
00437 <span class="preprocessor">#endif</span>
00438 <span class="preprocessor"></span><span class="preprocessor">#ifdef _STRING_</span>
00439 <span class="preprocessor"></span>    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, std::string&amp; Variable, <span class="keywordtype">bool</span> bSave)
00440     {
00441         <span class="keywordflow">if</span>(bSave)
00442         {
00443             ULONG Size = Variable.size()+1;
00444             TCHAR *pString;
00445 <span class="preprocessor">            #ifdef _UNICODE</span>
00446 <span class="preprocessor"></span>                pString = (<span class="keywordtype">wchar_t</span>*)_alloca(Size*2);
00447                 mbstowcs(pString, Variable.c_str(), Size);
00448 <span class="preprocessor">            #else</span>
00449 <span class="preprocessor"></span>                pString = const_cast&lt;TCHAR*&gt;(Variable.c_str());
00450 <span class="preprocessor">            #endif</span>
00451 <span class="preprocessor"></span>            <span class="keywordflow">return</span> SaveLoadItem(szName, pString, Size, bSave);
00452         }
00453         <span class="keywordflow">else</span>
00454         {
00455             TCHAR Buffer[1024];
00456             TCHAR *pBuf = Buffer;
00457             ULONG Size = <span class="keyword">sizeof</span>(Buffer)/<span class="keyword">sizeof</span>(Buffer[0]);
00458             <span class="keywordtype">bool</span> bResult = SaveLoadItem(szName, Buffer, Size, bSave);
00459             <span class="keywordflow">if</span> (!bResult)
00460             {
00461                 <span class="keywordflow">if</span> (Size == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00462                 pBuf = (TCHAR*)_alloca(Size);
00463                 bResult = SaveLoadItem(szName, pBuf, Size, bSave);
00464             }
00465 <span class="preprocessor">            #ifdef _UNICODE</span>
00466 <span class="preprocessor"></span>                CHAR *pMB = (CHAR*)_alloca(Size*2);
00467                 wcstombs(pMB, pBuf, Size);
00468                 Variable = pMB;
00469 <span class="preprocessor">            #else</span>
00470 <span class="preprocessor"></span>                Variable = pBuf;
00471 <span class="preprocessor">            #endif</span>
00472 <span class="preprocessor"></span>            <span class="keywordflow">return</span> bResult;
00473         }
00474     }
00475     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SaveLoadItem(LPCTSTR szName, std::wstring&amp; Variable, <span class="keywordtype">bool</span> bSave)
00476     {
00477         <span class="keywordflow">if</span>(bSave)
00478         {
00479             ULONG Size = Variable.size()+1;
00480             TCHAR *pString;
00481 <span class="preprocessor">            #ifdef _UNICODE</span>
00482 <span class="preprocessor"></span>                pString = const_cast&lt;TCHAR*&gt;(Variable.c_str());
00483 <span class="preprocessor">            #else</span>
00484 <span class="preprocessor"></span>                pString = (<span class="keywordtype">char</span>*)_alloca(Size*2);
00485                 wcstombs(pString, Variable.c_str(), Size);
00486 <span class="preprocessor">            #endif</span>
00487 <span class="preprocessor"></span>            <span class="keywordflow">return</span> SaveLoadItem(szName, pString, Size, bSave);
00488         }
00489         <span class="keywordflow">else</span>
00490         {
00491             TCHAR Buffer[1024];
00492             TCHAR *pBuf = Buffer;
00493             ULONG Size = <span class="keyword">sizeof</span>(Buffer)/<span class="keyword">sizeof</span>(Buffer[0]);
00494             <span class="keywordtype">bool</span> bResult = SaveLoadItem(szName, Buffer, Size, bSave);
00495             <span class="keywordflow">if</span> (!bResult)
00496             {
00497                 <span class="keywordflow">if</span> (Size == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00498                 pBuf = (TCHAR*)_alloca(Size);
00499                 bResult = SaveLoadItem(szName, pBuf, Size, bSave);
00500             }
00501 <span class="preprocessor">            #ifdef _UNICODE</span>
00502 <span class="preprocessor"></span>                Variable = pBuf;
00503 <span class="preprocessor">            #else</span>
00504 <span class="preprocessor"></span>                <span class="keywordtype">wchar_t</span> *pWide = (<span class="keywordtype">wchar_t</span>*)_alloca(Size*2);
00505                 mbstowcs(pWide, pBuf, Size);
00506                 Variable = pWide;
00507 <span class="preprocessor">            #endif</span>
00508 <span class="preprocessor"></span>            <span class="keywordflow">return</span> bResult;
00509         }
00510     }
00511 <span class="preprocessor">#endif</span>
00512 <span class="preprocessor"></span>
00514     <span class="comment">//------------------------------------------------------------------------------------</span>
00517 <span class="comment"></span>
00518 
00520     <span class="keyword">template</span> &lt;<span class="keyword">class</span> TArray, <span class="keyword">class</span> TArrayItem&gt; 
<a name="l00521"></a><a class="code" href="classCSettingsStorage.html#z16_0">00521</a>     <span class="keywordtype">bool</span> SaveLoadItemCArray(LPCTSTR szName, TArray&amp; Variable, TArrayItem&amp; dummy, <span class="keywordtype">bool</span> bSave)
00522     {
00523         <span class="keywordflow">if</span>(!bSave)
00524             Variable.RemoveAll();
00525 
00526         <span class="keywordtype">bool</span> bResult;
00527         UINT ItemCount = Variable.GetSize();
00528         <span class="keywordflow">if</span> (bResult=OnBeginCollection(szName, ItemCount, bSave))
00529         {
00530             <span class="keywordflow">if</span>(bSave)
00531             {
00532                 <span class="keywordflow">for</span>(UINT i = 0; i &lt; ItemCount; i++)
00533                 {
00534                     <span class="keywordflow">if</span> (0 == OnItemCollection(i, Variable[i], bSave))
00535                     {
00536                         bResult = <span class="keyword">false</span>;
00537                         <span class="keywordflow">if</span> (!ContinueOnError())
00538                             <span class="keywordflow">break</span>;
00539                     }
00540                 }
00541             }
00542             <span class="keywordflow">else</span>
00543             {
00544                 <span class="comment">// ItemCount can be 0xFFFFFFFF, which is fine for us because loop will be broken by the return code of OnItemCollection()</span>
00545                 <span class="keywordflow">for</span>(UINT i = 0; i &lt; ItemCount; i++)
00546                 {
00547                     TArrayItem item;
00548                     <span class="keywordtype">int</span> RetVal = OnItemCollection(i, item, bSave);
00549 
00550                     <span class="comment">// If no more items, break loop</span>
00551                     <span class="keywordflow">if</span> (RetVal &lt; 0)
00552                         <span class="keywordflow">break</span>;
00553 
00554                     <span class="keywordflow">if</span> (RetVal == 0)
00555                     {
00556                         bResult = <span class="keyword">false</span>;
00557                         <span class="keywordflow">if</span> (!ContinueOnError())
00558                             <span class="keywordflow">break</span>;
00559                     }
00560                     <span class="keywordflow">else</span>
00561                         Variable.Add(item);
00562                 }
00563             }
00564 
00565         }
00566         bResult &amp;= OnEndCollection(bSave);
00567         <span class="keywordflow">return</span> bResult;
00568     }
00569     
00571     <span class="keyword">template</span> &lt;<span class="keyword">class</span> TSTLArray&gt; 
<a name="l00572"></a><a class="code" href="classCSettingsStorage.html#z16_1">00572</a>     <span class="keywordtype">bool</span> SaveLoadItemSTL(LPCTSTR szName, TSTLArray&amp; Variable, <span class="keywordtype">bool</span> bSave)
00573     {
00574         <span class="keywordflow">if</span>(!bSave)
00575             Variable.clear();
00576 
00577         <span class="keywordtype">bool</span> bResult;
00578         UINT ItemCount = Variable.size();
00579         <span class="keywordflow">if</span> (bResult=OnBeginCollection(szName, ItemCount, bSave))
00580         {
00581             <span class="keywordflow">if</span>(bSave)
00582             {
00583                 UINT i = 0;
00584                 <span class="keywordflow">for</span>(TSTLArray::iterator it = Variable.begin(); it != Variable.end(); it++)
00585                 {
00586                     <span class="keywordflow">if</span> (0 == OnItemCollection(i, *it, bSave))
00587                     {
00588                         bResult = <span class="keyword">false</span>;
00589                         <span class="keywordflow">if</span> (!ContinueOnError())
00590                             <span class="keywordflow">break</span>;
00591                     }
00592                     i++;
00593                 }
00594             }
00595             <span class="keywordflow">else</span>
00596             {
00597                 <span class="comment">// ItemCount can be 0xFFFFFFFF, which is fine for us because loop will be broken by the return code of OnItemCollection()</span>
00598                 <span class="keywordflow">for</span>(UINT i = 0; i &lt; ItemCount; i++)
00599                 {
00600                     TSTLArray::value_type item;
00601                     <span class="keywordtype">int</span> RetVal = OnItemCollection(i, item, bSave);
00602 
00603                     <span class="comment">// If no more items, break loop</span>
00604                     <span class="keywordflow">if</span> (RetVal &lt; 0)
00605                         <span class="keywordflow">break</span>;
00606 
00607                     <span class="keywordflow">if</span> (0 == RetVal)
00608                     {
00609                         bResult = <span class="keyword">false</span>;
00610                         <span class="keywordflow">if</span> (!ContinueOnError())
00611                             <span class="keywordflow">break</span>;
00612                     }
00613                     <span class="keywordflow">else</span>
00614                         Variable.push_back(item);
00615                 }
00616             }
00617 
00618         }
00619         bResult &amp;= OnEndCollection(bSave);
00620         <span class="keywordflow">return</span> bResult;
00621     }
00622 
00624     <span class="keyword">template</span> &lt;<span class="keyword">class</span> TArray, <span class="keyword">class</span> TArrayItem&gt; 
<a name="l00625"></a><a class="code" href="classCSettingsStorage.html#z16_2">00625</a>     <span class="keywordtype">bool</span> SaveLoadItemCArrayAlone(LPCTSTR szName, TArray&amp; Variable, TArrayItem&amp; dummy, <span class="keywordtype">bool</span> bSave)
00626     {
00627         <span class="keywordflow">if</span>(!bSave)
00628             Variable.RemoveAll();
00629 
00630         <span class="keywordtype">bool</span> bResult = <span class="keyword">true</span>;
00631         UINT ItemCount = Variable.GetSize();
00632 
00633         <span class="keywordflow">if</span> (!OnBeginAloneCollection(szName, ItemCount, bSave))
00634             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00635 
00636         LPCTSTR ItemName;
00637         <span class="keywordflow">if</span>(bSave)
00638         {
00639             <span class="keywordflow">for</span>(UINT i = 0; i &lt; ItemCount; i++)
00640             {
00641                 <span class="keywordtype">int</span> RetVal = OnItemAloneCollection(i, bSave, ItemName);
00642                 <span class="keywordflow">if</span> (RetVal &lt; 0)
00643                     <span class="keywordflow">break</span>;
00644 
00645                 <span class="keywordflow">if</span> ((RetVal==0) || !m_pCollectionStorage-&gt;SaveLoadItem(ItemName, Variable[i], bSave))
00646                 {
00647                     bResult = <span class="keyword">false</span>;
00648                     <span class="keywordflow">if</span> (!ContinueOnError())
00649                         <span class="keywordflow">break</span>;
00650                 }
00651             }
00652         }
00653         <span class="keywordflow">else</span>
00654         {
00655             TArrayItem item;
00656             <span class="keywordflow">for</span>(UINT i = 0; i &lt; ItemCount; i++)
00657             {
00658                 <span class="keywordtype">int</span> RetVal = OnItemAloneCollection(i, bSave, ItemName);
00659                 <span class="keywordflow">if</span> (RetVal &lt; 0)
00660                     <span class="keywordflow">break</span>;
00661 
00662                 <span class="keywordflow">if</span> ((RetVal==0) || !m_pCollectionStorage-&gt;SaveLoadItem(ItemName, item, bSave))
00663                 {
00664                     bResult = <span class="keyword">false</span>;
00665                     <span class="keywordflow">if</span> (!ContinueOnError())
00666                         <span class="keywordflow">break</span>;
00667                 }
00668                 <span class="keywordflow">else</span>
00669                     Variable.Add(item);
00670             }
00671         }
00672 
00673         bResult &amp;= OnEndAloneCollection(bSave);
00674         <span class="keywordflow">return</span> bResult;
00675     }
00676 
00678     <span class="keyword">template</span> &lt;<span class="keyword">class</span> TSTLArray&gt; 
<a name="l00679"></a><a class="code" href="classCSettingsStorage.html#z16_3">00679</a>     <span class="keywordtype">bool</span> SaveLoadItemSTLAlone(LPCTSTR szName, TSTLArray&amp; Variable, <span class="keywordtype">bool</span> bSave)
00680     {
00681         <span class="keywordflow">if</span>(!bSave)
00682             Variable.clear();
00683 
00684         <span class="keywordtype">bool</span> bResult = <span class="keyword">true</span>;
00685         UINT ItemCount = Variable.size();
00686 
00687         <span class="keywordflow">if</span> (!OnBeginAloneCollection(szName, ItemCount, bSave))
00688             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00689 
00690         LPCTSTR ItemName;
00691         <span class="keywordflow">if</span>(bSave)
00692         {
00693             UINT i = 0;
00694             <span class="keywordflow">for</span>(TSTLArray::iterator it = Variable.begin(); it != Variable.end(); it++)
00695             {
00696                 <span class="keywordtype">int</span> RetVal = OnItemAloneCollection(i, bSave, ItemName);
00697                 <span class="keywordflow">if</span> (RetVal &lt; 0)
00698                     <span class="keywordflow">break</span>;
00699 
00700                 <span class="keywordflow">if</span> ((RetVal==0) || !m_pCollectionStorage-&gt;SaveLoadItem(ItemName, *it, bSave))
00701                 {
00702                     bResult = <span class="keyword">false</span>;
00703                     <span class="keywordflow">if</span> (!ContinueOnError())
00704                         <span class="keywordflow">break</span>;
00705                 }
00706                 i++;
00707             }
00708         }
00709         <span class="keywordflow">else</span>
00710         {
00711             TSTLArray::value_type item;
00712             <span class="keywordflow">for</span>(UINT i = 0; i &lt; ItemCount; i++)
00713             {
00714                 <span class="keywordtype">int</span> RetVal = OnItemAloneCollection(i, bSave, ItemName);
00715                 <span class="keywordflow">if</span> (RetVal &lt; 0)
00716                     <span class="keywordflow">break</span>;
00717 
00718                 <span class="keywordflow">if</span> ((RetVal==0) || !m_pCollectionStorage-&gt;SaveLoadItem(ItemName, item, bSave))
00719                 {
00720                     bResult = <span class="keyword">false</span>;
00721                     <span class="keywordflow">if</span> (!ContinueOnError())
00722                         <span class="keywordflow">break</span>;
00723                 }
00724                 <span class="keywordflow">else</span>
00725                     Variable.push_back(item);
00726             }
00727         }
00728 
00729         bResult &amp;= OnEndAloneCollection(bSave);
00730         <span class="keywordflow">return</span> bResult;
00731     }
00732 
00734 
00735 <span class="keyword">protected</span>:
00736     <a class="code" href="classCSettingsStorage.html">CSettingsStorage</a> *m_pCollectionStorage;
00737     TCHAR m_ItemName[16];
00738 };
00739 
00740 <span class="comment">//========================================================================================</span>
00741 
<a name="l00742"></a><a class="code" href="classCSettings.html#a0">00742</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classCSettings.html#a0">CSettings::Load</a>(<a class="code" href="classCSettingsStorage.html">CSettingsStorage</a> &amp;Storage)
00743 {
00744     <span class="keywordtype">bool</span> Result;
00745 
00746     OnBeforeLoad(Result = Storage.<a class="code" href="classCSettingsStorage.html#z4_2">OnBeforeLoad</a>());
00747 
00748     <span class="keywordflow">if</span> (Result)
00749         Result = InternalSaveLoad(Storage.<a class="code" href="classCSettingsStorage.html#z3_1">ContinueOnError</a>(), &amp;Storage, <span class="keyword">false</span>, <span class="keyword">false</span>);
00750 
00751     Result &amp;= Storage.<a class="code" href="classCSettingsStorage.html#z4_3">OnAfterLoad</a>();
00752     OnAfterLoad(Result);
00753 
00754     <span class="keywordflow">return</span> Result;
00755 }
00756 
<a name="l00761"></a><a class="code" href="classCSettings.html#a1">00761</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classCSettings.html#a1">CSettings::Save</a>(<a class="code" href="classCSettingsStorage.html">CSettingsStorage</a> &amp;Storage)
00762 {
00763     <span class="keywordtype">bool</span> Result;
00764 
00765     OnBeforeSave(Result = Storage.<a class="code" href="classCSettingsStorage.html#z4_0">OnBeforeSave</a>());
00766 
00767     <span class="keywordflow">if</span> (Result)
00768         Result = InternalSaveLoad(Storage.<a class="code" href="classCSettingsStorage.html#z3_1">ContinueOnError</a>(), &amp;Storage, <span class="keyword">true</span>, <span class="keyword">false</span>);
00769 
00770     Result &amp;= Storage.<a class="code" href="classCSettingsStorage.html#z4_1">OnAfterSave</a>();
00771     OnAfterSave(Result);
00772 
00773     <span class="keywordflow">return</span> Result;
00774 }
00775 
00776 
00777 }; <span class="comment">// namespace Mortimer</span>
00778 
00779 <span class="comment">//========================================================================================</span>
00780 <span class="comment">// MAP macros</span>
00781 
00782 <span class="preprocessor">#define BEGIN_SETTING_MAP(CLASS_NAME) \</span>
00783 <span class="preprocessor">    CLASS_NAME() \</span>
00784 <span class="preprocessor">    { \</span>
00785 <span class="preprocessor">        InternalSaveLoad(true, NULL, false, true); \</span>
00786 <span class="preprocessor">    } \</span>
00787 <span class="preprocessor">    virtual bool InternalSaveLoad(bool Continue, Mortimer::CSettingsStorage *pStorage, bool bSave, bool bOnlyInit) { \</span>
00788 <span class="preprocessor">    bool bResult = true;</span>
00789 <span class="preprocessor"></span>
00790 <span class="preprocessor">#define END_SETTING_MAP() return bResult; }</span>
00791 <span class="preprocessor"></span>
00792 
00793 <span class="preprocessor">#define SETTING_ITEM(variable) \</span>
00794 <span class="preprocessor">            if (!bOnlyInit) \</span>
00795 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItem(_T(#variable), variable, bSave)) { \</span>
00796 <span class="preprocessor">                if (!Continue) return false; \</span>
00797 <span class="preprocessor">                bResult &amp;= !bSave;}</span>
00798 <span class="preprocessor"></span>
00799 <span class="preprocessor">#define SETTING_ITEM_DEFAULT(variable, DEFAULT_VALUE) \</span>
00800 <span class="preprocessor">            if (bOnlyInit) variable = DEFAULT_VALUE; else \</span>
00801 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItem(_T(#variable), variable, bSave)) { \</span>
00802 <span class="preprocessor">                if (!Continue) return false; \</span>
00803 <span class="preprocessor">                if (!bSave) variable = DEFAULT_VALUE; \</span>
00804 <span class="preprocessor">                bResult &amp;= !bSave;}</span>
00805 <span class="preprocessor"></span>
00806 <span class="preprocessor">#define SETTING_ITEM_REQUIRE(variable) \</span>
00807 <span class="preprocessor">            if(!bOnlyInit) \</span>
00808 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItem(_T(#variable), variable, bSave)) { \</span>
00809 <span class="preprocessor">                if (!Continue) return false; \</span>
00810 <span class="preprocessor">                bResult = false;}</span>
00811 <span class="preprocessor"></span>
00812 <span class="preprocessor">#define SETTING_ITEM_SUBITEM(variable) \</span>
00813 <span class="preprocessor">            if (bOnlyInit) variable.InternalSaveLoad(Continue, NULL, false, true); else \</span>
00814 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItem(_T(#variable), variable, bSave)) { \</span>
00815 <span class="preprocessor">                if (!Continue) return false; \</span>
00816 <span class="preprocessor">                bResult &amp;= !bSave;}</span>
00817 <span class="preprocessor"></span>
00818 <span class="preprocessor">#define SETTING_ITEM_ARRAY(variable, itemtype) \</span>
00819 <span class="preprocessor">            if (!bOnlyInit) \</span>
00820 <span class="preprocessor">            { itemtype _dummy; \</span>
00821 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItemCArray(_T(#variable), variable, _dummy, bSave)) { \</span>
00822 <span class="preprocessor">                if (!Continue) return false; \</span>
00823 <span class="preprocessor">                bResult &amp;= !bSave;}}</span>
00824 <span class="preprocessor"></span>
00825 <span class="preprocessor">#define SETTING_ITEM_ARRAY_DEFAULT(variable, itemtype, DefaultValue) \</span>
00826 <span class="preprocessor">            if (bOnlyInit) { variable.RemoveAll(); for (int i=0; i&lt;DefaultValue.GetSize(); variable.Add(DefaultValue[i++])); } else \</span>
00827 <span class="preprocessor">            { itemtype _dummy; \</span>
00828 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItemCArray(_T(#variable), variable, _dummy, bSave)) { \</span>
00829 <span class="preprocessor">                if (!Continue) return false; \</span>
00830 <span class="preprocessor">                if (!bSave) { variable.RemoveAll(); for (int i=0; i&lt;DefaultValue.GetSize(); variable.Add(DefaultValue[i++])); } \</span>
00831 <span class="preprocessor">            bResult &amp;= !bSave;}}</span>
00832 <span class="preprocessor"></span>
00833 <span class="preprocessor">#define SETTING_ITEM_ARRAY_REQUIRE(variable, itemtype) \</span>
00834 <span class="preprocessor">            if (!bOnlyInit) \</span>
00835 <span class="preprocessor">            { itemtype _dummy; \</span>
00836 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItemCArray(_T(#variable), variable, _dummy, bSave)) { \</span>
00837 <span class="preprocessor">                if (!Continue) return false; \</span>
00838 <span class="preprocessor">                bResult = false;}}</span>
00839 <span class="preprocessor"></span>
00840 <span class="preprocessor">#define SETTING_ITEM_STL(variable) \</span>
00841 <span class="preprocessor">            if (!bOnlyInit) \</span>
00842 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItemSTL(_T(#variable), variable, bSave)) { \</span>
00843 <span class="preprocessor">                if (!Continue) return false; \</span>
00844 <span class="preprocessor">                bResult &amp;= !bSave;}</span>
00845 <span class="preprocessor"></span>
00846 <span class="preprocessor">#define SETTING_ITEM_STL_DEFAULT(variable, DefaultValue) \</span>
00847 <span class="preprocessor">            if (bOnlyInit) variable.assign(DefaultValue.begin(), DefaultValue.end()); else \</span>
00848 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItemSTL(_T(#variable), variable, bSave)) { \</span>
00849 <span class="preprocessor">                if (!Continue) return false; \</span>
00850 <span class="preprocessor">                if (!bSave) variable.assign(DefaultValue.begin(), DefaultValue.end()); \</span>
00851 <span class="preprocessor">                bResult &amp;= !bSave;}</span>
00852 <span class="preprocessor"></span>
00853 <span class="preprocessor">#define SETTING_ITEM_STL_REQUIRE(variable) \</span>
00854 <span class="preprocessor">            if (!bOnlyInit) \</span>
00855 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItemSTL(_T(#variable), variable, bSave)) { \</span>
00856 <span class="preprocessor">                if (!Continue) return false; \</span>
00857 <span class="preprocessor">                bResult = false;}</span>
00858 <span class="preprocessor"></span>
00859 <span class="preprocessor">#define SETTING_ITEM_ALONE_ARRAY(variable, itemtype) \</span>
00860 <span class="preprocessor">            if (!bOnlyInit) \</span>
00861 <span class="preprocessor">            { itemtype _dummy; \</span>
00862 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItemCArrayAlone(_T(#variable), variable, _dummy, bSave)) { \</span>
00863 <span class="preprocessor">                if (!Continue) return false; \</span>
00864 <span class="preprocessor">                bResult &amp;= !bSave;}}</span>
00865 <span class="preprocessor"></span>
00866 <span class="preprocessor">#define SETTING_ITEM_ALONE_ARRAY_DEFAULT(variable, itemtype, DefaultValue) \</span>
00867 <span class="preprocessor">            if (bOnlyInit) { variable.RemoveAll(); for (int i=0; i&lt;DefaultValue.GetSize(); variable.Add(DefaultValue[i++])); } else \</span>
00868 <span class="preprocessor">            { itemtype _dummy; \</span>
00869 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItemCArrayAlone(_T(#variable), variable, _dummy, bSave)) { \</span>
00870 <span class="preprocessor">                if (!Continue) return false; \</span>
00871 <span class="preprocessor">                if (!bSave) { variable.RemoveAll(); for (int i=0; i&lt;DefaultValue.GetSize(); variable.Add(DefaultValue[i++])); } \</span>
00872 <span class="preprocessor">            bResult &amp;= !bSave;}}</span>
00873 <span class="preprocessor"></span>
00874 <span class="preprocessor">#define SETTING_ITEM_ALONE_ARRAY_REQUIRE(variable, itemtype) \</span>
00875 <span class="preprocessor">            if (!bOnlyInit) \</span>
00876 <span class="preprocessor">            { itemtype _dummy; \</span>
00877 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItemCArrayAlone(_T(#variable), variable, _dummy, bSave)) { \</span>
00878 <span class="preprocessor">                if (!Continue) return false; \</span>
00879 <span class="preprocessor">                bResult = false;}}</span>
00880 <span class="preprocessor"></span>
00881 <span class="preprocessor">#define SETTING_ITEM_ALONE_STL(variable) \</span>
00882 <span class="preprocessor">            if (!bOnlyInit) \</span>
00883 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItemSTLAlone(_T(#variable), variable, bSave)) { \</span>
00884 <span class="preprocessor">                if (!Continue) return false; \</span>
00885 <span class="preprocessor">                bResult &amp;= !bSave;}</span>
00886 <span class="preprocessor"></span>
00887 <span class="preprocessor">#define SETTING_ITEM_ALONE_STL_DEFAULT(variable, DefaultValue) \</span>
00888 <span class="preprocessor">            if (bOnlyInit) variable.assign(DefaultValue.begin(), DefaultValue.end()); else \</span>
00889 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItemSTLAlone(_T(#variable), variable, bSave)) { \</span>
00890 <span class="preprocessor">                if (!Continue) return false; \</span>
00891 <span class="preprocessor">                if (!bSave) variable.assign(DefaultValue.begin(), DefaultValue.end()); \</span>
00892 <span class="preprocessor">                bResult &amp;= !bSave;}</span>
00893 <span class="preprocessor"></span>
00894 <span class="preprocessor">#define SETTING_ITEM_ALONE_STL_REQUIRE(variable) \</span>
00895 <span class="preprocessor">            if (!bOnlyInit) \</span>
00896 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItemSTLAlone(_T(#variable), variable, bSave)) { \</span>
00897 <span class="preprocessor">                if (!Continue) return false; \</span>
00898 <span class="preprocessor">                bResult = false;}</span>
00899 <span class="preprocessor"></span>
00900 <span class="preprocessor">#define SETTING_ITEM_SZ(variable, variable_len) \</span>
00901 <span class="preprocessor">            if (!bOnlyInit) \</span>
00902 <span class="preprocessor">            { ULONG size = variable_len; if (!pStorage-&gt;SaveLoadItem(_T(#variable), variable, size, bSave)) { \</span>
00903 <span class="preprocessor">                if (!Continue) return false; \</span>
00904 <span class="preprocessor">                bResult &amp;= !bSave;}}</span>
00905 <span class="preprocessor"></span>
00906 <span class="preprocessor">#define SETTING_ITEM_SZ_DEFAULT(variable, variable_len, DEFAULT_VALUE) \</span>
00907 <span class="preprocessor">            if (bOnlyInit) _tcsncpy(variable, DEFAULT_VALUE, variable_len); else \</span>
00908 <span class="preprocessor">            { ULONG size = variable_len; if (!pStorage-&gt;SaveLoadItem(_T(#variable), variable, size, bSave)) { \</span>
00909 <span class="preprocessor">                if (!Continue) return false; \</span>
00910 <span class="preprocessor">                if (!bSave) _tcsncpy(variable, DEFAULT_VALUE, variable_len); \</span>
00911 <span class="preprocessor">                bResult &amp;= !bSave;}}</span>
00912 <span class="preprocessor"></span>
00913 <span class="preprocessor">#define SETTING_ITEM_SZ_REQUIRE(variable, variable_len) \</span>
00914 <span class="preprocessor">            if (!bOnlyInit) \</span>
00915 <span class="preprocessor">            { ULONG size = variable_len; if (!pStorage-&gt;SaveLoadItem(_T(#variable), variable, size, bSave)) { \</span>
00916 <span class="preprocessor">                if (!Continue) return false; \</span>
00917 <span class="preprocessor">                bResult = false;}}</span>
00918 <span class="preprocessor"></span>
00919 <span class="preprocessor">#define SETTING_ITEM_BINARY(variable, variable_size) \</span>
00920 <span class="preprocessor">            if (!bOnlyInit) \</span>
00921 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItem(_T(#variable), (void*)&amp;variable, variable_size, bSave)) { \</span>
00922 <span class="preprocessor">                if (!Continue) return false; \</span>
00923 <span class="preprocessor">                bResult &amp;= !bSave;}</span>
00924 <span class="preprocessor"></span>
00925 <span class="preprocessor">#define SETTING_ITEM_BINARY_DEFAULT(variable, variable_size, pDefaultValue) \</span>
00926 <span class="preprocessor">            if (bOnlyInit) { if (pDefaultValue) memcpy((void*)&amp;variable, (void*)pDefaultValue, variable_size); } else \</span>
00927 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItem(_T(#variable), (void*)&amp;variable, variable_size, bSave)) { \</span>
00928 <span class="preprocessor">                if (!Continue) return false; \</span>
00929 <span class="preprocessor">                if (!bSave &amp;&amp; pDefaultValue) memcpy((void*)&amp;variable, (void*)pDefaultValue, variable_size); \</span>
00930 <span class="preprocessor">                bResult &amp;= !bSave;}</span>
00931 <span class="preprocessor"></span>
00932 <span class="preprocessor">#define SETTING_ITEM_BINARY_REQUIRE(variable, variable_size) \</span>
00933 <span class="preprocessor">            if (!bOnlyInit) \</span>
00934 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItem(_T(#variable), (void*)&amp;variable, variable_size, bSave)) } \</span>
00935 <span class="preprocessor">                if (!Continue) return false; \</span>
00936 <span class="preprocessor">                bResult = false;}</span>
00937 <span class="preprocessor"></span>
00938 <span class="preprocessor">#define SETTING_ITEM_BINARYPTR(variable, variable_size) \</span>
00939 <span class="preprocessor">            if (!bOnlyInit) \</span>
00940 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItemSTL(_T(#variable), (void*)variable, variable_size, bSave)) { \</span>
00941 <span class="preprocessor">                if (!Continue) return false; \</span>
00942 <span class="preprocessor">                bResult &amp;= !bSave;}</span>
00943 <span class="preprocessor"></span>
00944 <span class="preprocessor">#define SETTING_ITEM_BINARYPTR_DEFAULT(variable, variable_size, pDefaultValue) \</span>
00945 <span class="preprocessor">            if (bOnlyInit) { if (pDefaultValue) memcpy((void*)variable, (void*)pDefaultValue, variable_size); } else \</span>
00946 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItem(_T(#variable), (void*)variable, variable_size, bSave)) { \</span>
00947 <span class="preprocessor">                if (!Continue) return false; \</span>
00948 <span class="preprocessor">                if (!bSave &amp;&amp; pDefaultValue) memcpy((void*)variable, (void*)pDefaultValue, variable_size); \</span>
00949 <span class="preprocessor">                bResult &amp;= !bSave;}</span>
00950 <span class="preprocessor"></span>
00951 <span class="preprocessor">#define SETTING_ITEM_BINARYPTR_REQUIRE(variable, variable_size) \</span>
00952 <span class="preprocessor">            if (!bOnlyInit) \</span>
00953 <span class="preprocessor">            if (!pStorage-&gt;SaveLoadItem(_T(#variable), (void*)variable, variable_size, bSave)) } \</span>
00954 <span class="preprocessor">                if (!Continue) return false; \</span>
00955 <span class="preprocessor">                bResult = false;}</span>
00956 <span class="preprocessor"></span>
00957 
00958 <span class="preprocessor">#endif // __MORTIMER_SETTINGSSTORAGE_H__</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri May 28 11:14:20 2004 for SettingsStorage by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
